<!--
Copyright 2018 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->

---
title: "construction investment"
output:
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: inline
---

```{r include=FALSE}

knitr::opts_chunk$set(echo = FALSE, message = FALSE)

```

# Survey of Employment, Payrolls and Hours


This set of scripts creates summary tables and graphs plotting the monthly SEPH data collected and reported by Statistics Canada.

#### packages

```{r, packages}

# tidyverse
library(tidyverse)
library(stringr)
library(glue)

# monthly data series
library(lubridate)
# extending ggplot2
library(scales)

# cansim
#install.packages("devtools")
#devtools::install_github("mountainmath/cansim")
library(cansim)

# utilities
library(brickr)
library(here)
library(janitor)

### ---
# bonus function for "not in" (opposite of %in%)
# https://stackoverflow.com/a/50255505/4170032
`%!in%` <- purrr::compose(`!`, `%in%`)

```

---

## Background


The Daily, 2019-07-25: Investment in building construction, June 2019
https://www150.statcan.gc.ca/n1/daily-quotidien/190821/dq190821b-eng.htm?CMP=mstatcan



## -- Data

* Investment in Building Construction

  - Table: 34-10-0175-01
  
  - https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=3410017501


### Read the data


**NOTE:**

This script uses the [R package {cansim}](https://github.com/mountainMath/cansim)


```{r data_read}

#data_34_10_0175 <- get_cansim("34-10-0175-01")

data_34_10_0175 <- read_csv(here("data", "34100175.csv"))

data_coninv <- data_34_10_0175 %>%
  janitor::clean_names() %>%
  mutate(ref_date = ymd(ref_date, truncated = 2))

ls.str(data_coninv)


```


### filters & groups

* geo == `British Columbia`

* investment_value

* type_of_structure

```{r}

data_coninv_bc <- data_coninv %>%
  filter(geo == "British Columbia")

unique(data_coninv$investment_value)

```


```{r}


last_date <- max(data_coninv_bc$ref_date)

data_coninv_bc <- data_coninv_bc %>%
  filter(ref_date == last_date,
         investment_value == "Unadjusted - constant")

data_coninv_bc

```

## plot

```{r}

coninv_plot <- ggplot(data_coninv_bc) +
  aes(x=type_of_structure, y=value) + 
  geom_brick_col(two_knob = FALSE) +
  coord_brick_flip() 
#  scale_fill_brick() 
#  theme_brick()

coninv_plot

```

plot, with formatting

```{r}

coninv_plot +
  labs(title = "Employment in B.C.'s construction industry continues to grow",
       subtitle = "The month of May, 2010-2019",
       caption = "Statistics Canada.  Table  14-10-0201-01   Employment by industry, monthly, unadjusted for seasonality") +
  xlab(element_blank()) +
  ylab("number of persons") +
  scale_y_continuous(labels = comma)

```

```{r}

coninv_plot +
  labs(title = "Employment in B.C.'s construction industry continues to grow",
       subtitle = "The month of May, 2010-2019",
       caption = "Statistics Canada.  Table  14-10-0201-01   Employment by industry, monthly, unadjusted for seasonality") +
  xlab("year") +
  ylab("number of persons") +
  scale_y_continuous(labels = comma) +
  scale_x_date(date_labels = "%Y",
               date_breaks = "1 year", 
               minor_breaks = NULL) 
#  theme(panel.grid.minor.x = element_blank())

```


```{r}



coninv_plot +
  labs(title = "Employment in B.C.'s construction industry continues to grow",
       subtitle = "The number of persons employed during the month of May, 2010-2019",
       caption = "Source: Statistics Canada. Table 14-10-0201-01; Employment by industry, monthly, unadjusted for seasonality") +
  xlab("year") +
  ylab("number of persons") +
  scale_y_continuous(labels = comma) +
  scale_x_date(date_labels = "%Y",
               date_breaks = "1 year", 
               minor_breaks = NULL) 
               


```


```{r}

data_coninv <- data_coninv %>%
  mutate(year_ref = as.factor(year(ref_date)))

coninv_plot <- ggplot(data_coninv) +
  aes(x=year_ref, y=value) + 
  geom_brick_col() 

coninv_plot


coninv_plot +
  labs(title = "Employment in B.C.'s construction industry continues to grow",
       subtitle = "The number of persons employed during the month of May, 2010-2019",
       caption = "Source: Statistics Canada. Table 14-10-0201-01; Employment by industry, monthly, unadjusted for seasonality") +
  xlab("year") +
  ylab("number of persons") +
  scale_y_continuous(labels = comma)
               

ggsave(filename = "SEPH_construction_plot.png", 
       width = 8, height = 6)



```


-30-