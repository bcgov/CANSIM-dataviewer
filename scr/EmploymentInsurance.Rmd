---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

# Employment Insurance


This set of scripts creates summary tables and graphs plotting the Monthly Survey of Manufacturing data collected and reported by Statistics Canada.

#### packages

```{r}

# tidyverse
library(tidyverse)
#library(readr)
#library(ggplot2) 
#library(dplyr)
library(stringr)
library(glue)

# monthly data series
library(lubridate)
# extending ggplot2
#library("scales")

# cansim
#install.packages("devtools")
#devtools::install_github("mountainmath/cansim")
library(cansim)

```

---

## Background

The Daily, 2018-09-20

* https://www150.statcan.gc.ca/n1/daily-quotidien/180920/dq180920a-eng.htm?HPA=1 



## data

There are 12 data tables associated with this:
https://www150.statcan.gc.ca/n1/daily-quotidien/180920/dq180920a-cansim-eng.htm


Our focus is on the seasonally adjusted series.



Provincial:

* Employment insurance claims received by province and territory, monthly, seasonally adjusted

  - Table: 14-10-0005-01 (formerly CANSIM  276-0004)
  
  - https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410000501 

* Employment insurance regular income benefit characteristics, monthly, seasonally adjusted

  - Table: 14-10-0008-01 (formerly CANSIM  276-0018)
  
  - https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410000801
  
* Employment insurance beneficiaries (regular benefits) by province and territory, monthly, seasonally adjusted

  - Table: 14-10-0011-01 (formerly CANSIM  276-0022)

  - https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410001101
  
* Employment insurance beneficiaries (regular benefits) by census metropolitan category[^1], monthly, seasonally adjusted

  - Table: 14-10-0013-01 (formerly CANSIM  276-0034)

  - https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410001301
  
  
* Employment insurance beneficiaries (regular benefits) by province, territory and occupation, monthly, seasonally adjusted

  - Table: 14-10-0337-01 (formerly CANSIM  276-0043)

  - https://www150.statcan.gc.ca/t1/tbl1/en/tv.action?pid=1410033701
  


###

Read the data


```{r}

data_10_0005 <- get_cansim("14-10-0005-01")

data_10_0005 <- data_10_0005 %>%
    mutate(REF_DATE = ymd(REF_DATE, truncated = 2)) 
  
data_10_0008 <- get_cansim("14-10-0008-01")

data_10_0008 <- data_10_0008 %>%
    mutate(REF_DATE = ymd(REF_DATE, truncated = 2)) 

data_10_0011 <- get_cansim("14-10-0011-01")

data_10_0011 <- data_10_0011 %>%
    mutate(REF_DATE = ymd(REF_DATE, truncated = 2)) 

data_10_0013 <- get_cansim("14-10-0013-01")

data_10_0013 <- data_10_0013 %>%
    mutate(REF_DATE = ymd(REF_DATE, truncated = 2)) 

data_10_0337 <- get_cansim("14-10-0337-01")

data_10_00337 <- data_10_0337 %>%
    mutate(REF_DATE = ymd(REF_DATE, truncated = 2)) 

```



this month

```{r}

filenamenum <- "data_10_0011"

print(glue("TABLE:  ", filenamenum))

ls.str(data_10_0011)

unique(data_10_0011$`Beneficiary detail`)


data_10_0011 %>%
  filter(GEO %in% c("Canada", "British Columbia"),
    `Beneficiary detail` == "Regular benefits",
    Sex == "Both sexes",
    `Age group` == "15 years and over",
    REF_DATE == "2018-07-01")



data_10_0011 %>%
  filter(GEO %in% c("Canada", "British Columbia"),
    `Beneficiary detail` == "Regular benefits",
    Sex == "Both sexes",
    `Age group` == "15 years and over") %>%
  group_by(GEO) %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
  arrange(desc(REF_DATE)) %>%
  filter(REF_DATE == "2018-07-01")

```


plot: BC trend

```{r}

data_10_0011 %>%
  filter(GEO %in% c("British Columbia"),
    `Beneficiary detail` == "Regular benefits",
    Sex == "Both sexes",
    `Age group` == "15 years and over") %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
  select(REF_DATE, VALUE, MOM_pct, MOM_val) %>%
#filter(REF_DATE == "2018-07-01")
  filter(REF_DATE >= "2006-01-01")


data_10_0011 %>%
  filter(GEO %in% c("British Columbia"),
    `Beneficiary detail` == "Regular benefits",
    Sex == "Both sexes",
    `Age group` == "15 years and over") %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
#filter(REF_DATE == "2018-07-01")
  filter(REF_DATE >= "2005-01-01") %>%
  ggplot(aes(x=REF_DATE, y=VALUE)) + 
    geom_line(size=1.5) 


```



Geography


```{r}


unique(data_10_0013$GeoUID)

CMA_CA_list <- c("[11124]",
                 "[59]", "[59A]", "[932]", "[915]", "[933]", "[935]", 
                 "[59B]", "[944]", "[930]", "[943]", "[905]", 
                 "[975]", "[937]", "[977]", "[925]", "[938]", "[939]", 
                 "[913]", "[940]", "[945]", "[970]", "[955]", "[952]", 
                 "[920]", "[934]", "[965]", "[918]", "[950]", 
                 "[59C]", "[59996]", "[59997]", "[59998]", "[59999]")


filenamenum <- "data_10_0013"

print(glue("TABLE:  ", filenamenum))

ls.str(data_10_0013)



data_10_0013 %>%
  filter(GeoUID %in% CMA_CA_list) %>%
  group_by(GEO) %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
#  arrange(desc(REF_DATE)) %>%
  filter(REF_DATE == "2018-07-01")



data_10_0013 %>%
  filter(GeoUID %in% CMA_CA_list) %>%
  group_by(GEO) %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
  arrange(desc(MOM_val)) %>%
  filter(REF_DATE == "2018-07-01")

CMA_list <- c("[59A]", "[932]", "[915]", "[933]", "[935]")

data_10_0013 %>%
  filter(GeoUID %in% CMA_list) %>%
  group_by(GEO) %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
  arrange(desc(MOM_pct)) %>%
  filter(REF_DATE == "2018-07-01")


CA_list <- c("[59B]", "[944]", "[930]", "[943]", "[905]", 
             "[975]", "[937]", "[977]", "[925]", "[938]", "[939]", 
             "[913]", "[940]", "[945]", "[970]", "[955]", "[952]", 
             "[920]", "[934]", "[965]", "[918]", "[950]")


data_10_0013 %>%
  filter(GeoUID %in% CA_list) %>%
  group_by(GEO) %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
  arrange(desc(MOM_pct)) %>%
  filter(REF_DATE == "2018-07-01")

```



## July 2018 text

Issue 18-nnn Employment Insurance

September 20, 2018

The number of people receiving employment insurance (EI) benefits in British Columbia rose 2.2% in July compared to June (seasonally adjusted), up by 900 to reach 42,570 individuals. This was the first increase seen since November 2017, and only the third in the 21 months since November 2016. In October 2016, the total number of people in B.C. receiving EI benefits was 57,000. In the last decade, the number of EI recipients in B.C. peaked at nearly 98,000 in June 2009.

```{r}

data_10_0011 %>%
  filter(GEO %in% c("British Columbia"),
    `Beneficiary detail` == "Regular benefits",
    Sex == "Both sexes",
    `Age group` == "15 years and over") %>%
  mutate(MOM_pct = VALUE / lag(VALUE),
         MOM_val = VALUE - lag(VALUE)) %>%
#filter(REF_DATE == "2018-07-01")
  filter(REF_DATE >= "2005-01-01") %>%
  ggplot(aes(x=REF_DATE, y=VALUE)) + 
    geom_line(size=1.5) 

```


The increase in beneficiaries in British Columbia was observed in all census metropolitan areas in B.C. (+3.1%, or 680 persons). The largest increase was seen in Victoria, which added 290 persons (+14.5%) and Abbotsford (+140 persons, +7.7%). Census agglomerations also saw an aggregate increase (370 persons or +3.4%), although this ranged from a high of 31% (+110 persons) in Duncan to drop of 10.5% (-20 persons) in Dawson Creek. Areas outside census metropolitan areas and census agglomerations saw a drop of 140 persons or -1.5%.


original from  June:


The decrease was driven by a decline in female recipients (-170 persons or -1.0%), while male recipients saw a very slight drop in the month (-30 persons or  0.1%).
 Among census metropolitan areas (+50 persons or 0.2%), Kelowna (-30 persons or -1.3%) and Victoria (-10 persons or -0.5%) saw fewer EI recipients in the month, more than offset by a larger number of recipients in Vancouver (+20 persons or +0.1%) and Abbotsford-Mission (+60 persons or +3.6%).
The number of EI claims in British Columbia (an indicator of the number of future EI recipients) went up by 0.5% in June compared to the previous month.
Nationally, the number of EI beneficiaries increased in June, with 3,760 more people collecting EI, a 0.8% climb compared to May. Although the number of women receiving EI declined in the month ( 2,700 persons or  1.6%), it was not enough to offset the upsurge in male recipients (+6,460 persons or +2.3%). The number of EI claims went up by 3.7% in June to reach 236,200. Claims increased in all provinces, except Newfoundland and Labrador (-4.3%).

Data Source: Statistics Canada (https://www150.statcan.gc.ca/n1/daily-quotidien/180920/dq180920a-eng.htm)




***

### footnotes

[^1]
>Geographical definitions: A census metropolitan area (CMA) or a census agglomeration (CA) is formed by one or more adjacent municipalities centred on a population centre. A CMA must have a total population of at least 100,000. A CA must have a population of at least 10,000. See Standard Geographical Classification 2011 â€“ definitions for more information.
